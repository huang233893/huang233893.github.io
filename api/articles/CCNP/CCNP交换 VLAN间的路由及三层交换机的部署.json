{"title":"VLAN间的路由及三层交换机的部署","slug":"CCNP/CCNP交换 VLAN间的路由及三层交换机的部署","date":"2024-11-21T01:01:46.000Z","updated":"2025-08-02T15:09:26.545Z","comments":true,"path":"api/articles/CCNP/CCNP交换 VLAN间的路由及三层交换机的部署.json","excerpt":null,"covers":["https://cdn.nlark.com/yuque/0/2024/png/44908083/1729153334630-a8c6d042-08e1-4b43-87f8-aa6252bf8900.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729153355876-a7ca5fed-7f69-4e14-82d7-b5d7aa717043.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729162997065-d2ea58a5-246a-44d6-925d-3b16b41a0532.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729163085261-9648ecce-8584-479f-a56a-bf5679c5b3bf.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729164827120-91130c8c-63de-4e8f-8628-0259875e2c44.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165022772-166a0a14-8a04-4f1f-be6f-226ecbf1918a.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165215265-252a3155-b8c1-4065-9cc0-764a2291e798.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729163463953-598b285c-b189-41f6-80b0-e3a5a7637588.png"],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h2 id=\"Q-A\"><a href=\"#Q-A\" class=\"headerlink\" title=\"Q &amp; A\"></a>Q &amp; A</h2><h3 id=\"如何满足不同VLAN的互访需求？\"><a href=\"#如何满足不同VLAN的互访需求？\" class=\"headerlink\" title=\"如何满足不同VLAN的互访需求？\"></a>如何满足不同VLAN的互访需求？</h3><ul>\n<li>解决方案1：单臂路由</li>\n</ul>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729153334630-a8c6d042-08e1-4b43-87f8-aa6252bf8900.png\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729153355876-a7ca5fed-7f69-4e14-82d7-b5d7aa717043.png\"></p>\n<h2 id=\"路由-VS-交换的园区网结构\"><a href=\"#路由-VS-交换的园区网结构\" class=\"headerlink\" title=\"路由 VS. 交换的园区网结构\"></a>路由 VS. 交换的园区网结构</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729162997065-d2ea58a5-246a-44d6-925d-3b16b41a0532.png\"></p>\n<ul>\n<li>在过去，交换是基于硬件的转发，而路由是基于软件的转发，因此园区网络更多的采用交换网络的设计</li>\n<li>而如今，路由已经几乎与交换一样快，也能够基于硬件做转发，与此同时路由的设计很好的解决了交换网络的二层环路问题，以及LAN的隔离问题</li>\n</ul>\n<h2 id=\"Switch-Virtual-interface（SVI）\"><a href=\"#Switch-Virtual-interface（SVI）\" class=\"headerlink\" title=\"Switch Virtual interface（SVI）\"></a>Switch Virtual interface（SVI）</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729163085261-9648ecce-8584-479f-a56a-bf5679c5b3bf.png\"></p>\n<h2 id=\"SVI-autostate-exclude-command\"><a href=\"#SVI-autostate-exclude-command\" class=\"headerlink\" title=\"SVI autostate exclude command\"></a>SVI autostate exclude command</h2><ul>\n<li>SVI口的Line-state在以下条件满足的情况下才会是UP<ul>\n<li>SVI对应的VLAN必须在vlan database中存在并且是激活的</li>\n<li>Vlan interface存在并且不能说administratively down的</li>\n<li>必须至少有一个二层接口（SVI对于VLAN的access接口或者trunk口）是UP的，而且必须是spanning-tree的forwarding状态</li>\n</ul>\n</li>\n<li>SVI autostate exclude特性可以让特定接口跳出上述up-and-down的计算过程，也就是说该接口的up down与SVI口的up down无关了</li>\n</ul>\n<p><code>Switch(config)# int f0/24</code></p>\n<p><code>Switch(config-if)# switchport auto-state exclude</code></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729164827120-91130c8c-63de-4e8f-8628-0259875e2c44.png\"></p>\n<h2 id=\"交换机管理VLAN\"><a href=\"#交换机管理VLAN\" class=\"headerlink\" title=\"交换机管理VLAN\"></a>交换机管理VLAN</h2><h3 id=\"二层交换机的管理VLAN\"><a href=\"#二层交换机的管理VLAN\" class=\"headerlink\" title=\"二层交换机的管理VLAN\"></a>二层交换机的管理VLAN</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165022772-166a0a14-8a04-4f1f-be6f-226ecbf1918a.png\"></p>\n<ul>\n<li>交换机的管理VLAN用于交换机本身的设备管理</li>\n<li>二层交换机只能有一个VLAN接口可以拥有IP地址，具体的VLAN可以根据实际需求选定</li>\n<li>有了这个VLAN接口，PC就能够telnet到交换机上执行管理操作</li>\n<li>用户VLAN与交换管理VLAN重叠会有什么问题？</li>\n</ul>\n<h3 id=\"三层交换环境的管理VLAN\"><a href=\"#三层交换环境的管理VLAN\" class=\"headerlink\" title=\"三层交换环境的管理VLAN\"></a>三层交换环境的管理VLAN</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165215265-252a3155-b8c1-4065-9cc0-764a2291e798.png\"></p>\n<h2 id=\"三层交换机的端口模式\"><a href=\"#三层交换机的端口模式\" class=\"headerlink\" title=\"三层交换机的端口模式\"></a>三层交换机的端口模式</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729163463953-598b285c-b189-41f6-80b0-e3a5a7637588.png\"></p>\n<ul>\n<li>二层接口：access模式，trunk模式</li>\n<li>三层接口：路由接口（no switchport或称为routed port）、SVI接口</li>\n</ul>\n<h2 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Switch(config)# ip routing</span><br><span class=\"line\">#\t开启三层交换机路由功能</span><br><span class=\"line\"></span><br><span class=\"line\">Switch(config)# vlan 10</span><br><span class=\"line\">Switch(config-vlan)# name name</span><br><span class=\"line\"># 创建VLAN</span><br><span class=\"line\"></span><br><span class=\"line\">Switch(config)# int vlan 10 </span><br><span class=\"line\">Switch(config-Vlanif10)# ip add x.x.x.x mask </span><br><span class=\"line\">Switch(config-Vlanif10)# no sh</span><br><span class=\"line\">#\t配置VLAN对于SVI接口</span><br><span class=\"line\"></span><br><span class=\"line\">Switch(config)# int f0/1</span><br><span class=\"line\">Switch(config-if)# no switchport</span><br><span class=\"line\">Switch(config-if)# ip add x.x.x.x mask</span><br><span class=\"line\">Switch(config-if)# no sh</span><br><span class=\"line\">#\t配置no switchport（routed port）三层接口</span><br><span class=\"line\"></span><br><span class=\"line\">Switch(config)# ip route 0.0.0.0 0.0.0.0 x.x.x.x</span><br><span class=\"line\">#\t配置静态路由</span><br></pre></td></tr></table></figure>","more":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h2 id=\"Q-A\"><a href=\"#Q-A\" class=\"headerlink\" title=\"Q &amp; A\"></a>Q &amp; A</h2><h3 id=\"如何满足不同VLAN的互访需求？\"><a href=\"#如何满足不同VLAN的互访需求？\" class=\"headerlink\" title=\"如何满足不同VLAN的互访需求？\"></a>如何满足不同VLAN的互访需求？</h3><ul>\n<li>解决方案1：单臂路由</li>\n</ul>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729153334630-a8c6d042-08e1-4b43-87f8-aa6252bf8900.png\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729153355876-a7ca5fed-7f69-4e14-82d7-b5d7aa717043.png\"></p>\n<h2 id=\"路由-VS-交换的园区网结构\"><a href=\"#路由-VS-交换的园区网结构\" class=\"headerlink\" title=\"路由 VS. 交换的园区网结构\"></a>路由 VS. 交换的园区网结构</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729162997065-d2ea58a5-246a-44d6-925d-3b16b41a0532.png\"></p>\n<ul>\n<li>在过去，交换是基于硬件的转发，而路由是基于软件的转发，因此园区网络更多的采用交换网络的设计</li>\n<li>而如今，路由已经几乎与交换一样快，也能够基于硬件做转发，与此同时路由的设计很好的解决了交换网络的二层环路问题，以及LAN的隔离问题</li>\n</ul>\n<h2 id=\"Switch-Virtual-interface（SVI）\"><a href=\"#Switch-Virtual-interface（SVI）\" class=\"headerlink\" title=\"Switch Virtual interface（SVI）\"></a>Switch Virtual interface（SVI）</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729163085261-9648ecce-8584-479f-a56a-bf5679c5b3bf.png\"></p>\n<h2 id=\"SVI-autostate-exclude-command\"><a href=\"#SVI-autostate-exclude-command\" class=\"headerlink\" title=\"SVI autostate exclude command\"></a>SVI autostate exclude command</h2><ul>\n<li>SVI口的Line-state在以下条件满足的情况下才会是UP<ul>\n<li>SVI对应的VLAN必须在vlan database中存在并且是激活的</li>\n<li>Vlan interface存在并且不能说administratively down的</li>\n<li>必须至少有一个二层接口（SVI对于VLAN的access接口或者trunk口）是UP的，而且必须是spanning-tree的forwarding状态</li>\n</ul>\n</li>\n<li>SVI autostate exclude特性可以让特定接口跳出上述up-and-down的计算过程，也就是说该接口的up down与SVI口的up down无关了</li>\n</ul>\n<p><code>Switch(config)# int f0/24</code></p>\n<p><code>Switch(config-if)# switchport auto-state exclude</code></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729164827120-91130c8c-63de-4e8f-8628-0259875e2c44.png\"></p>\n<h2 id=\"交换机管理VLAN\"><a href=\"#交换机管理VLAN\" class=\"headerlink\" title=\"交换机管理VLAN\"></a>交换机管理VLAN</h2><h3 id=\"二层交换机的管理VLAN\"><a href=\"#二层交换机的管理VLAN\" class=\"headerlink\" title=\"二层交换机的管理VLAN\"></a>二层交换机的管理VLAN</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165022772-166a0a14-8a04-4f1f-be6f-226ecbf1918a.png\"></p>\n<ul>\n<li>交换机的管理VLAN用于交换机本身的设备管理</li>\n<li>二层交换机只能有一个VLAN接口可以拥有IP地址，具体的VLAN可以根据实际需求选定</li>\n<li>有了这个VLAN接口，PC就能够telnet到交换机上执行管理操作</li>\n<li>用户VLAN与交换管理VLAN重叠会有什么问题？</li>\n</ul>\n<h3 id=\"三层交换环境的管理VLAN\"><a href=\"#三层交换环境的管理VLAN\" class=\"headerlink\" title=\"三层交换环境的管理VLAN\"></a>三层交换环境的管理VLAN</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165215265-252a3155-b8c1-4065-9cc0-764a2291e798.png\"></p>\n<h2 id=\"三层交换机的端口模式\"><a href=\"#三层交换机的端口模式\" class=\"headerlink\" title=\"三层交换机的端口模式\"></a>三层交换机的端口模式</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729163463953-598b285c-b189-41f6-80b0-e3a5a7637588.png\"></p>\n<ul>\n<li>二层接口：access模式，trunk模式</li>\n<li>三层接口：路由接口（no switchport或称为routed port）、SVI接口</li>\n</ul>\n<h2 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Switch(config)# ip routing</span><br><span class=\"line\">#\t开启三层交换机路由功能</span><br><span class=\"line\"></span><br><span class=\"line\">Switch(config)# vlan 10</span><br><span class=\"line\">Switch(config-vlan)# name name</span><br><span class=\"line\"># 创建VLAN</span><br><span class=\"line\"></span><br><span class=\"line\">Switch(config)# int vlan 10 </span><br><span class=\"line\">Switch(config-Vlanif10)# ip add x.x.x.x mask </span><br><span class=\"line\">Switch(config-Vlanif10)# no sh</span><br><span class=\"line\">#\t配置VLAN对于SVI接口</span><br><span class=\"line\"></span><br><span class=\"line\">Switch(config)# int f0/1</span><br><span class=\"line\">Switch(config-if)# no switchport</span><br><span class=\"line\">Switch(config-if)# ip add x.x.x.x mask</span><br><span class=\"line\">Switch(config-if)# no sh</span><br><span class=\"line\">#\t配置no switchport（routed port）三层接口</span><br><span class=\"line\"></span><br><span class=\"line\">Switch(config)# ip route 0.0.0.0 0.0.0.0 x.x.x.x</span><br><span class=\"line\">#\t配置静态路由</span><br></pre></td></tr></table></figure>","categories":[{"name":"思科","path":"api/categories/思科.json"}],"tags":[{"name":"网络","path":"api/tags/网络.json"},{"name":"CCNP","path":"api/tags/CCNP.json"}]}