{"title":"路由选择原理","slug":"CCNP/CCNP路由 路由选择原理","date":"2024-11-21T01:01:46.000Z","updated":"2025-08-02T09:54:36.598Z","comments":true,"path":"api/articles/CCNP/CCNP路由 路由选择原理.json","excerpt":null,"covers":["https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556630961-3d015d9f-3ae5-4c13-80fd-44414035a0ed.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556639379-05e1075f-512e-4609-9792-e21fcde11d20.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729557010043-46b3011e-6b27-48c8-9f06-c8b053d29574.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729557446146-ebde076d-6d67-4744-b602-f3af3c202b25.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729558543372-6f0ce184-42bb-46e0-b9de-9f3f89514936.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729558770399-0145f42d-3b34-47d4-8415-b50b98eeaf42.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729565436293-0236dbc1-1d8c-4bd1-a0c3-df14ecd55870.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729566091093-7800b4ae-dc55-4da4-b7c4-0c96f54807fc.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729578966077-6f787972-1326-45fc-b640-0408a427dc5e.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729580677499-e739e627-2e8e-4eb7-9a22-19a2caf8e673.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729565692870-f2f68474-85ac-4f44-b6ff-8ff47e689483.png"],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h2 id=\"路由选择原理\"><a href=\"#路由选择原理\" class=\"headerlink\" title=\"路由选择原理\"></a>路由选择原理</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556630961-3d015d9f-3ae5-4c13-80fd-44414035a0ed.png\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556639379-05e1075f-512e-4609-9792-e21fcde11d20.png\"></p>\n<ul>\n<li>路由信息来源</li>\n<li>管理距离（AD值）</li>\n<li>有类及无类路由查找</li>\n<li>最长匹配原则</li>\n<li>递归查询</li>\n</ul>\n<h2 id=\"路由信息的来源\"><a href=\"#路由信息的来源\" class=\"headerlink\" title=\"路由信息的来源\"></a>路由信息的来源</h2><ul>\n<li>直连路由<ul>\n<li>接口配置IP，该接口的物理层和数据链路层UP</li>\n<li>通过接口感知到的直连网络</li>\n</ul>\n</li>\n<li>静态路由<ul>\n<li>使用静态路由命令手工配置的路由</li>\n</ul>\n</li>\n<li>动态路由<ul>\n<li>通过动态路由协议学习</li>\n<li>常见路由协议：RIP、OSPF、IS-IS、EIGRP、BGP</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"管理距离（AD值）\"><a href=\"#管理距离（AD值）\" class=\"headerlink\" title=\"管理距离（AD值）\"></a>管理距离（AD值）</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729557010043-46b3011e-6b27-48c8-9f06-c8b053d29574.png\"></p>\n<h2 id=\"有类及无类路由查找\"><a href=\"#有类及无类路由查找\" class=\"headerlink\" title=\"有类及无类路由查找\"></a>有类及无类路由查找</h2><ul>\n<li><strong>无类路由查找</strong>：路由器不会注意目的地址的类别，它会在目的地址和所有己知的路由之间逐位(bit by bit)执行最长匹配</li>\n<li><strong>有类路由查找</strong>（no ip classless）：路由器收到一个数据包时，先查找目的地址所属主类网络，如果路由表中存在该主类网络的路由，则继续找子网，如果没有子网路由则丢弃数据包（即使本地有默认路由，也同样丢弃），如果有则正常转发;而如果本地路由表里没有该目的地址所属主类网络的路由，则看是否有默认路由，如果有，则转发，如果没有，则丢弃。</li>\n</ul>\n<h2 id=\"最长匹配原则\"><a href=\"#最长匹配原则\" class=\"headerlink\" title=\"最长匹配原则\"></a>最长匹配原则</h2><ul>\n<li>主机地址（主机路径）</li>\n<li>子网</li>\n<li>一组子网（汇总路由）</li>\n<li>主网号</li>\n<li>超网（CIDR）</li>\n<li>缺省地址</li>\n</ul>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729557446146-ebde076d-6d67-4744-b602-f3af3c202b25.png\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729558543372-6f0ce184-42bb-46e0-b9de-9f3f89514936.png\"></p>\n<h2 id=\"路由表的查找\"><a href=\"#路由表的查找\" class=\"headerlink\" title=\"路由表的查找\"></a>路由表的查找</h2><ul>\n<li>不同的前缀，在路由表中属于不同的路由</li>\n<li>相同的前缀，先比AD，后比metric</li>\n<li>匹配，转发；不匹配，丢弃</li>\n<li>路由器的行为是逐跳的，到目标网络的沿路径每个路由器都必须有关于目标的路由</li>\n<li>数据是双向的，考虑流量的时候，要关注流量的往返</li>\n</ul>\n<h2 id=\"路由表的递归查询\"><a href=\"#路由表的递归查询\" class=\"headerlink\" title=\"路由表的递归查询\"></a>路由表的递归查询</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729558770399-0145f42d-3b34-47d4-8415-b50b98eeaf42.png\"></p>\n<h2 id=\"协议分类\"><a href=\"#协议分类\" class=\"headerlink\" title=\"协议分类\"></a>协议分类</h2><ul>\n<li>有类路由选择协议：RIPv1、IGRP<ul>\n<li><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729565436293-0236dbc1-1d8c-4bd1-a0c3-df14ecd55870.png\"></li>\n</ul>\n</li>\n<li>无类路由选择协议：OSPF、EIGRP、ISIS、BGP等</li>\n<li>根本区别在于：更新消息中是否含有网络掩码</li>\n</ul>\n<h2 id=\"浮动的静态路由\"><a href=\"#浮动的静态路由\" class=\"headerlink\" title=\"浮动的静态路由\"></a>浮动的静态路由</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729566091093-7800b4ae-dc55-4da4-b7c4-0c96f54807fc.png\"></p>\n<ul>\n<li>通过修改缺省的管理具体实现路由冗余</li>\n</ul>\n<h3 id=\"静态路由汇总\"><a href=\"#静态路由汇总\" class=\"headerlink\" title=\"静态路由汇总\"></a>静态路由汇总</h3><ul>\n<li>改变子网掩码，通过汇总路由匹配明细，从而简化路由表</li>\n</ul>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729578966077-6f787972-1326-45fc-b640-0408a427dc5e.png\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729580677499-e739e627-2e8e-4eb7-9a22-19a2caf8e673.png\"></p>\n<h2 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729565692870-f2f68474-85ac-4f44-b6ff-8ff47e689483.png\"></p>\n<p><code>Ip route 192.168.10.0 255.255.255.0 192.168.1.1</code></p>\n<p>使用指向下一跳的静态路由</p>\n<p><code>Ip route 192.168.10.0 255.255.255.0 fa 0/0</code></p>\n<p>使用指向出接口的静态路由该条目将作为直连网络输入到路由表中如果出接口为广播型接口，可能会给接口下的节点造成额外的负担(ARP)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Router# show ip route</span><br><span class=\"line\">Gateway of last resort is not set </span><br><span class=\"line\">9.0.0.0/2 4 is subnetted,2 subnets</span><br><span class=\"line\">C\t\t9.9.12.0 is directly connected, FastEthernet0/0</span><br><span class=\"line\">S\t\t9.9.23.0 is directly connected, FastEthernet0/0</span><br></pre></td></tr></table></figure>","more":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h2 id=\"路由选择原理\"><a href=\"#路由选择原理\" class=\"headerlink\" title=\"路由选择原理\"></a>路由选择原理</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556630961-3d015d9f-3ae5-4c13-80fd-44414035a0ed.png\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729556639379-05e1075f-512e-4609-9792-e21fcde11d20.png\"></p>\n<ul>\n<li>路由信息来源</li>\n<li>管理距离（AD值）</li>\n<li>有类及无类路由查找</li>\n<li>最长匹配原则</li>\n<li>递归查询</li>\n</ul>\n<h2 id=\"路由信息的来源\"><a href=\"#路由信息的来源\" class=\"headerlink\" title=\"路由信息的来源\"></a>路由信息的来源</h2><ul>\n<li>直连路由<ul>\n<li>接口配置IP，该接口的物理层和数据链路层UP</li>\n<li>通过接口感知到的直连网络</li>\n</ul>\n</li>\n<li>静态路由<ul>\n<li>使用静态路由命令手工配置的路由</li>\n</ul>\n</li>\n<li>动态路由<ul>\n<li>通过动态路由协议学习</li>\n<li>常见路由协议：RIP、OSPF、IS-IS、EIGRP、BGP</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"管理距离（AD值）\"><a href=\"#管理距离（AD值）\" class=\"headerlink\" title=\"管理距离（AD值）\"></a>管理距离（AD值）</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729557010043-46b3011e-6b27-48c8-9f06-c8b053d29574.png\"></p>\n<h2 id=\"有类及无类路由查找\"><a href=\"#有类及无类路由查找\" class=\"headerlink\" title=\"有类及无类路由查找\"></a>有类及无类路由查找</h2><ul>\n<li><strong>无类路由查找</strong>：路由器不会注意目的地址的类别，它会在目的地址和所有己知的路由之间逐位(bit by bit)执行最长匹配</li>\n<li><strong>有类路由查找</strong>（no ip classless）：路由器收到一个数据包时，先查找目的地址所属主类网络，如果路由表中存在该主类网络的路由，则继续找子网，如果没有子网路由则丢弃数据包（即使本地有默认路由，也同样丢弃），如果有则正常转发;而如果本地路由表里没有该目的地址所属主类网络的路由，则看是否有默认路由，如果有，则转发，如果没有，则丢弃。</li>\n</ul>\n<h2 id=\"最长匹配原则\"><a href=\"#最长匹配原则\" class=\"headerlink\" title=\"最长匹配原则\"></a>最长匹配原则</h2><ul>\n<li>主机地址（主机路径）</li>\n<li>子网</li>\n<li>一组子网（汇总路由）</li>\n<li>主网号</li>\n<li>超网（CIDR）</li>\n<li>缺省地址</li>\n</ul>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729557446146-ebde076d-6d67-4744-b602-f3af3c202b25.png\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729558543372-6f0ce184-42bb-46e0-b9de-9f3f89514936.png\"></p>\n<h2 id=\"路由表的查找\"><a href=\"#路由表的查找\" class=\"headerlink\" title=\"路由表的查找\"></a>路由表的查找</h2><ul>\n<li>不同的前缀，在路由表中属于不同的路由</li>\n<li>相同的前缀，先比AD，后比metric</li>\n<li>匹配，转发；不匹配，丢弃</li>\n<li>路由器的行为是逐跳的，到目标网络的沿路径每个路由器都必须有关于目标的路由</li>\n<li>数据是双向的，考虑流量的时候，要关注流量的往返</li>\n</ul>\n<h2 id=\"路由表的递归查询\"><a href=\"#路由表的递归查询\" class=\"headerlink\" title=\"路由表的递归查询\"></a>路由表的递归查询</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729558770399-0145f42d-3b34-47d4-8415-b50b98eeaf42.png\"></p>\n<h2 id=\"协议分类\"><a href=\"#协议分类\" class=\"headerlink\" title=\"协议分类\"></a>协议分类</h2><ul>\n<li>有类路由选择协议：RIPv1、IGRP<ul>\n<li><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729565436293-0236dbc1-1d8c-4bd1-a0c3-df14ecd55870.png\"></li>\n</ul>\n</li>\n<li>无类路由选择协议：OSPF、EIGRP、ISIS、BGP等</li>\n<li>根本区别在于：更新消息中是否含有网络掩码</li>\n</ul>\n<h2 id=\"浮动的静态路由\"><a href=\"#浮动的静态路由\" class=\"headerlink\" title=\"浮动的静态路由\"></a>浮动的静态路由</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729566091093-7800b4ae-dc55-4da4-b7c4-0c96f54807fc.png\"></p>\n<ul>\n<li>通过修改缺省的管理具体实现路由冗余</li>\n</ul>\n<h3 id=\"静态路由汇总\"><a href=\"#静态路由汇总\" class=\"headerlink\" title=\"静态路由汇总\"></a>静态路由汇总</h3><ul>\n<li>改变子网掩码，通过汇总路由匹配明细，从而简化路由表</li>\n</ul>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729578966077-6f787972-1326-45fc-b640-0408a427dc5e.png\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729580677499-e739e627-2e8e-4eb7-9a22-19a2caf8e673.png\"></p>\n<h2 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729565692870-f2f68474-85ac-4f44-b6ff-8ff47e689483.png\"></p>\n<p><code>Ip route 192.168.10.0 255.255.255.0 192.168.1.1</code></p>\n<p>使用指向下一跳的静态路由</p>\n<p><code>Ip route 192.168.10.0 255.255.255.0 fa 0/0</code></p>\n<p>使用指向出接口的静态路由该条目将作为直连网络输入到路由表中如果出接口为广播型接口，可能会给接口下的节点造成额外的负担(ARP)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Router# show ip route</span><br><span class=\"line\">Gateway of last resort is not set </span><br><span class=\"line\">9.0.0.0/2 4 is subnetted,2 subnets</span><br><span class=\"line\">C\t\t9.9.12.0 is directly connected, FastEthernet0/0</span><br><span class=\"line\">S\t\t9.9.23.0 is directly connected, FastEthernet0/0</span><br></pre></td></tr></table></figure>","categories":[{"name":"思科","path":"api/categories/思科.json"}],"tags":[{"name":"网络","path":"api/tags/网络.json"},{"name":"CCNP","path":"api/tags/CCNP.json"}]}