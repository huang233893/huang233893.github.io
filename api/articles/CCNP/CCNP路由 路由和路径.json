{"title":"路由和路径","slug":"CCNP/CCNP路由 路由和路径","date":"2024-11-21T01:01:46.000Z","updated":"2025-08-03T04:55:47.388Z","comments":true,"path":"api/articles/CCNP/CCNP路由 路由和路径.json","excerpt":null,"covers":["https://cdn.nlark.com/yuque/0/2024/png/44908083/1730252795715-71f9fcc0-544c-41e7-94a1-cdde5265b108.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730253536563-710553ac-ca47-4ce5-9027-a64118280c8e.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730256948062-64555df9-3f06-41ec-b0c2-9c14cd5cc025.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730257151571-18b8b2e8-3c79-40ea-b97c-d622e5dc20b8.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730257180586-f3f245e3-f240-4044-b59e-b2154fde1431.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730339033871-1958274b-9355-4326-a286-f9c3e31efd0e.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730339568655-3eb7af04-e1a6-498c-85a3-f72f55fcd42a.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730765382208-5939d7f3-0224-48a4-8bd2-4b38e06c0c22.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730765432018-af56c92b-2a62-4a66-8430-79f752fc4a02.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730768260182-2e14961d-ad68-4651-ae82-e9eebcc05966.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730768421821-4f542729-31cd-484e-bd5c-0c7a22b12463.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730771586431-d5907351-8a3b-4875-bb63-9a586ef96637.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730773350466-5d587359-93a3-41f8-ae95-2a94868aecb4.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775469785-37c97bda-3880-410d-bb4d-3def31028fb9.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775507016-b35087ed-da05-4558-aed6-aafa6e38c85e.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775547268-b569e647-03d1-41eb-b6f6-444d7cd1ac02.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1730788273052-453973f9-cb0f-4d85-a1a5-2ed89d2b898b.png"],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h1 id=\"路由部分\"><a href=\"#路由部分\" class=\"headerlink\" title=\"路由部分\"></a>路由部分</h1><h2 id=\"网络中使用多种IP路由协议\"><a href=\"#网络中使用多种IP路由协议\" class=\"headerlink\" title=\"网络中使用多种IP路由协议\"></a>网络中使用多种IP路由协议</h2><p>需要使用多种IP路由协议的原因-多厂商的路由环境</p>\n<ul>\n<li>网络合并(同一协议或是不同协议)</li>\n<li>从旧的路由协议过渡到新的路由协议</li>\n<li>路由策略的需要(可靠性、冗余性、分流模型等)</li>\n</ul>\n<p>路由重分发(多个重分发点，双向重分发)</p>\n<h2 id=\"路由重发布\"><a href=\"#路由重发布\" class=\"headerlink\" title=\"路由重发布\"></a>路由重发布</h2><h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>路由重分发是指连接到不同路由域(自治系统)的边界路由器在他们之间交换和通告路由选择信息的能力。</p>\n<ul>\n<li>从一种协议到另一种协议</li>\n<li>同一种协议的多个实例</li>\n</ul>\n<p>注意</p>\n<ul>\n<li>重分发总是向外的，执行重分发的路由器不会修改其路由表</li>\n<li>路由必须要位于路由表中才能被重分发</li>\n</ul>\n<h3 id=\"路由重发布-1\"><a href=\"#路由重发布-1\" class=\"headerlink\" title=\"路由重发布\"></a>路由重发布</h3><ul>\n<li>重发布要考虑的因素<ul>\n<li>路由回馈</li>\n<li>路由信息不兼容（度量值信息不一致）</li>\n<li>收敛时间不一致（不同路由协议的收敛速度不同）</li>\n</ul>\n</li>\n<li>如果选择最佳路由<ul>\n<li>管理距离</li>\n<li>度量值</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"路由回馈\"><a href=\"#路由回馈\" class=\"headerlink\" title=\"路由回馈\"></a>路由回馈</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730252795715-71f9fcc0-544c-41e7-94a1-cdde5265b108.png\"></p>\n<ul>\n<li></li>\n</ul>\n<ul>\n<li>度量值–种子度量值</li>\n<li>路由器通告与其接口直接相连的链路时，使用的初始度量值叫做种子度量值(也叫做默认度量值)，是根据接口的特征得到的。</li>\n<li>种子度量值或默认度量值是在重分发配置期间定义的，并在自治系统内部正常递增，除了OSPF E2路由。</li>\n<li>可使用命令default-metric或是redistribute中使用metric来指定种子度量值</li>\n</ul>\n<h3 id=\"度量值——默认种子度量值\"><a href=\"#度量值——默认种子度量值\" class=\"headerlink\" title=\"度量值——默认种子度量值\"></a>度量值——默认种子度量值</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730253536563-710553ac-ca47-4ce5-9027-a64118280c8e.png\"></p>\n<h3 id=\"单点重分发\"><a href=\"#单点重分发\" class=\"headerlink\" title=\"单点重分发\"></a>单点重分发</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730256948062-64555df9-3f06-41ec-b0c2-9c14cd5cc025.png\"></p>\n<p>单向重分发</p>\n<p>双向重分发</p>\n<h3 id=\"多点单向重发布\"><a href=\"#多点单向重发布\" class=\"headerlink\" title=\"多点单向重发布\"></a>多点单向重发布</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730257151571-18b8b2e8-3c79-40ea-b97c-d622e5dc20b8.png\"></p>\n<h3 id=\"多点双向重发布\"><a href=\"#多点双向重发布\" class=\"headerlink\" title=\"多点双向重发布\"></a>多点双向重发布</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730257180586-f3f245e3-f240-4044-b59e-b2154fde1431.png\"></p>\n<h1 id=\"Passive-interface\"><a href=\"#Passive-interface\" class=\"headerlink\" title=\"Passive-interface\"></a>Passive-interface</h1><ul>\n<li>RIP&#x2F;IGRP——在指定接口不向外发送路由更新，但是接收路由更新</li>\n<li>EIGRP——在指定接口不向外发送Hello消息，而且通过这个接口不与其他路由器建立邻接关系，不发送其它EIGRP的数据流</li>\n<li>OSPF——在指定接口不向外发送Hello消息，而且通过这 个接口不与其他路由器建立邻接关系，不发送和接收路由信息。(有些IOS版本中OSPF在被动接口上发送Helo和DBD分组，但是不发送LSU。)</li>\n</ul>\n<h2 id=\"Tips\"><a href=\"#Tips\" class=\"headerlink\" title=\"Tips\"></a>Tips</h2><ul>\n<li>汇聚交换机上所有的三层接口都Network进相应的Area</li>\n<li>汇聚交换机将向所有VLAN接口发送HELLO报文，尝试建立邻居关系，而底层的用户也会收到其并不需要的HELLO包</li>\n</ul>\n<h2 id=\"Passive-interface与单播更新\"><a href=\"#Passive-interface与单播更新\" class=\"headerlink\" title=\"Passive-interface与单播更新\"></a>Passive-interface与单播更新</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730339033871-1958274b-9355-4326-a286-f9c3e31efd0e.png\"></p>\n<p>配置RIP单播更新</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Router(config)# router rip</span><br><span class=\"line\">Router(config-router)# passive-interface int-type int-num</span><br><span class=\"line\">Router(config-router)# neighbor 192.168.123.3</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"常见路由协议管理距离\"><a href=\"#常见路由协议管理距离\" class=\"headerlink\" title=\"常见路由协议管理距离\"></a>常见路由协议管理距离</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730339568655-3eb7af04-e1a6-498c-85a3-f72f55fcd42a.png\"></p>\n<h1 id=\"Route-map\"><a href=\"#Route-map\" class=\"headerlink\" title=\"Route-map\"></a>Route-map</h1><h2 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h2><ul>\n<li>使用的match命令匹配特定的分组或路由，set修改该分组或路由的相关属性</li>\n<li>Route-map中的语句相当于访问列表中的各行</li>\n<li>Route-map默认为permit，默认序列号为10，序列号不会自动递增，需要指定序列号</li>\n<li>末尾隐含deny any</li>\n<li>单挑match语句包括多个条件时，使用逻辑or运算；多条match语句时，使用逻辑and运算</li>\n</ul>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">match ip address 匹配访问列表或前缀列表</span><br><span class=\"line\">match length 根据分组的第三层长度进行匹配</span><br><span class=\"line\">match interface 匹配下一跳出接口为指定接口之一的路由</span><br><span class=\"line\">match ip next-hop 匹配下一跳地址为特定访问列表中被允许的那些路由</span><br><span class=\"line\">match metric 匹配具有指定度量值的路由</span><br><span class=\"line\">match route-type 匹配指定类型的路由</span><br><span class=\"line\">match community 匹配BGP共同体</span><br><span class=\"line\">match tag 根据路由的标记进行匹配</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"distribute-list\"><a href=\"#distribute-list\" class=\"headerlink\" title=\"distribute-list\"></a>distribute-list</h1><h2 id=\"distribute-list-可根据下列因素过滤更新\"><a href=\"#distribute-list-可根据下列因素过滤更新\" class=\"headerlink\" title=\"distribute-list 可根据下列因素过滤更新\"></a>distribute-list 可根据下列因素过滤更新</h2><ul>\n<li>入站接口</li>\n<li>出站接口</li>\n<li>从另一种路由协议重分发</li>\n</ul>\n<h2 id=\"对于距离矢量路由协议\"><a href=\"#对于距离矢量路由协议\" class=\"headerlink\" title=\"对于距离矢量路由协议\"></a>对于距离矢量路由协议</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730765382208-5939d7f3-0224-48a4-8bd2-4b38e06c0c22.png\"></p>\n<h2 id=\"对于链路状态路由协议\"><a href=\"#对于链路状态路由协议\" class=\"headerlink\" title=\"对于链路状态路由协议\"></a>对于链路状态路由协议</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730765432018-af56c92b-2a62-4a66-8430-79f752fc4a02.png\"></p>\n<h2 id=\"配置-1\"><a href=\"#配置-1\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730768260182-2e14961d-ad68-4651-ae82-e9eebcc05966.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">R2(config)# access-list 1 permit 192.168.1.0</span><br><span class=\"line\">R2(config)# access-list 1 permit 192.168.2.0</span><br><span class=\"line\">R2(config)# router rip</span><br><span class=\"line\">R2(config-router)# distribute-list 1 out fa 1/0</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"prefix-list\"><a href=\"#prefix-list\" class=\"headerlink\" title=\"prefix-list\"></a>prefix-list</h1><h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730768421821-4f542729-31cd-484e-bd5c-0c7a22b12463.png\"></p>\n<ul>\n<li>外部路由172.16.32.0-39.0&#x2F;24，以及汇总路由32.0&#x2F;21被R1引入OSPF现在需在注入过程中，仅将汇总路由32.0&#x2F;21过滤，所有明细放行，使用ACL匹配路由，该如何写?</li>\n</ul>\n<p><code>R1(config)# access-list 1 deny 172.16.32.0\t#如果加上反掩码呢</code></p>\n<p><code>R1(config)# access-ist 1 permit any</code></p>\n<h2 id=\"前缀列表\"><a href=\"#前缀列表\" class=\"headerlink\" title=\"前缀列表\"></a>前缀列表</h2><ul>\n<li>前缀列表的可控性比访问列表高得多，支持增量修改，更为灵活</li>\n<li>判断路由前缀与前缀列表中的前缀是否匹配</li>\n<li>前缀列表包含序列号，从最小的开始匹配，默认序列为5，以5增加</li>\n<li>如果前缀不与前缀列表中的任何条目匹配，将被拒绝</li>\n</ul>\n<h2 id=\"配置-2\"><a href=\"#配置-2\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730771586431-d5907351-8a3b-4875-bb63-9a586ef96637.png\"></p>\n<p><code>router(config)# **ip prefix-list** &#123;list-name [**seq** number] &#123;**deny | permit**&#125; _network/length_ [**ge** _ge-value_] [**le** _le-value_]</code></p>\n<p>输入条件：length &lt; ge-value &lt; le-value &lt;&#x3D; 32</p>\n<h3 id=\"配置示例\"><a href=\"#配置示例\" class=\"headerlink\" title=\"配置示例\"></a>配置示例</h3><ul>\n<li>匹配某条特定路由：192.168.1.0&#x2F;24<ul>\n<li><code>ip prefix-list pxlist 192.168.1.0/24</code></li>\n</ul>\n</li>\n<li>匹配默认路由：<ul>\n<li><code>ip prefix-list pxlist permit 0.0.0.0/0</code></li>\n</ul>\n</li>\n<li>匹配所有主机路由：<ul>\n<li><code>ip prefix-list pxlist permit 0.0.0.0/0 ge 32</code></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"路径控制\"><a href=\"#路径控制\" class=\"headerlink\" title=\"路径控制\"></a>路径控制</h1><p>网络实现冗余，还需要考虑以下问题</p>\n<ul>\n<li>弹性：实现链路的主动切换同时备用链路可用于负载均衡</li>\n<li>可用性：从主链路切换到备用链路的时间</li>\n<li>自适应：主链路拥塞时也可以使用冗余路径</li>\n<li>性能：提高带宽的使用率</li>\n</ul>\n<h2 id=\"路径控制工具\"><a href=\"#路径控制工具\" class=\"headerlink\" title=\"路径控制工具\"></a>路径控制工具</h2><ul>\n<li>妥善的编制方案：VLSM和CIDR</li>\n<li>重分发和路由协议的特征</li>\n<li>passive-interface</li>\n<li>distribute-list</li>\n<li>prefix-list</li>\n<li>AD的把控</li>\n<li>route-map</li>\n<li>路由标记</li>\n<li>offset-list</li>\n<li>路由标记</li>\n<li>思科IOS IP SLAs</li>\n<li>PBR</li>\n</ul>\n<h2 id=\"offset-list的作用\"><a href=\"#offset-list的作用\" class=\"headerlink\" title=\"offset-list的作用\"></a>offset-list的作用</h2><ul>\n<li>用于在入站或出站时增大通过EIGRP或RIP获悉的路由度量值</li>\n</ul>\n<p><code>router(config-router)# offset-list &#123;access-list-number| name&#125; &#123;in|out&#125; offset [interface-type interface-number]</code></p>\n<h2 id=\"offset-list的配置\"><a href=\"#offset-list的配置\" class=\"headerlink\" title=\"offset-list的配置\"></a>offset-list的配置</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730773350466-5d587359-93a3-41f8-ae95-2a94868aecb4.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">access-list 1 permit 10.1.1.0</span><br><span class=\"line\">router rip</span><br><span class=\"line\">offset-list 1 out 2 serial 0/0</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"PBR策略路由\"><a href=\"#PBR策略路由\" class=\"headerlink\" title=\"PBR策略路由\"></a>PBR策略路由</h1><h2 id=\"PBR\"><a href=\"#PBR\" class=\"headerlink\" title=\"PBR\"></a>PBR</h2><ul>\n<li>基于策略的路由比传统路由能力更强，使用更灵活，它使网络管理者不仅能够根据目的地址而且能够根据协议类型、报文大小、应用或IP源地址来选择转发路径。策略可以定义为通过多路由器的负载平衡或根据总流量在各线上进行报文转发的服务质量来定义策略路由。</li>\n<li>策略路由主要对经过路由器的数据流进行分流和过滤以及感兴趣数据流匹配</li>\n</ul>\n<h2 id=\"传统路由VS策略路由\"><a href=\"#传统路由VS策略路由\" class=\"headerlink\" title=\"传统路由VS策略路由\"></a>传统路由VS策略路由</h2><h3 id=\"传统路由\"><a href=\"#传统路由\" class=\"headerlink\" title=\"传统路由\"></a>传统路由</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775469785-37c97bda-3880-410d-bb4d-3def31028fb9.png\"></p>\n<h3 id=\"策略路由\"><a href=\"#策略路由\" class=\"headerlink\" title=\"策略路由\"></a>策略路由</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775507016-b35087ed-da05-4558-aed6-aafa6e38c85e.png\"></p>\n<h2 id=\"PBR对数据的处理\"><a href=\"#PBR对数据的处理\" class=\"headerlink\" title=\"PBR对数据的处理\"></a>PBR对数据的处理</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775547268-b569e647-03d1-41eb-b6f6-444d7cd1ac02.png\"></p>\n<h2 id=\"配置-3\"><a href=\"#配置-3\" class=\"headerlink\" title=\"配置\"></a>配置</h2><ul>\n<li>设定分组的下一跳IP（必须为直连IP）<ul>\n<li><code>set ip next-hop ip-address [...ip-address]</code></li>\n</ul>\n</li>\n<li>设定分组的出接口<ul>\n<li><code>set interface type number [...type number]</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"场景1\"><a href=\"#场景1\" class=\"headerlink\" title=\"场景1\"></a>场景1</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730788273052-453973f9-cb0f-4d85-a1a5-2ed89d2b898b.png\"></p>\n<ul>\n<li>当网络正常时，PC访问外网数据走ISP1</li>\n<li>当ISP1宕机时(GW感知到)，数据切换至ISP2</li>\n<li>当ISP1容机时(GW无感知)，数据仍然走ISP1</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">access-list 1 permit any</span><br><span class=\"line\">route-map PBR permit 10</span><br><span class=\"line\">match ip address 1</span><br><span class=\"line\">set ip next-hop 10.1.1.2 10.2.2.2</span><br></pre></td></tr></table></figure>","more":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h1 id=\"路由部分\"><a href=\"#路由部分\" class=\"headerlink\" title=\"路由部分\"></a>路由部分</h1><h2 id=\"网络中使用多种IP路由协议\"><a href=\"#网络中使用多种IP路由协议\" class=\"headerlink\" title=\"网络中使用多种IP路由协议\"></a>网络中使用多种IP路由协议</h2><p>需要使用多种IP路由协议的原因-多厂商的路由环境</p>\n<ul>\n<li>网络合并(同一协议或是不同协议)</li>\n<li>从旧的路由协议过渡到新的路由协议</li>\n<li>路由策略的需要(可靠性、冗余性、分流模型等)</li>\n</ul>\n<p>路由重分发(多个重分发点，双向重分发)</p>\n<h2 id=\"路由重发布\"><a href=\"#路由重发布\" class=\"headerlink\" title=\"路由重发布\"></a>路由重发布</h2><h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>路由重分发是指连接到不同路由域(自治系统)的边界路由器在他们之间交换和通告路由选择信息的能力。</p>\n<ul>\n<li>从一种协议到另一种协议</li>\n<li>同一种协议的多个实例</li>\n</ul>\n<p>注意</p>\n<ul>\n<li>重分发总是向外的，执行重分发的路由器不会修改其路由表</li>\n<li>路由必须要位于路由表中才能被重分发</li>\n</ul>\n<h3 id=\"路由重发布-1\"><a href=\"#路由重发布-1\" class=\"headerlink\" title=\"路由重发布\"></a>路由重发布</h3><ul>\n<li>重发布要考虑的因素<ul>\n<li>路由回馈</li>\n<li>路由信息不兼容（度量值信息不一致）</li>\n<li>收敛时间不一致（不同路由协议的收敛速度不同）</li>\n</ul>\n</li>\n<li>如果选择最佳路由<ul>\n<li>管理距离</li>\n<li>度量值</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"路由回馈\"><a href=\"#路由回馈\" class=\"headerlink\" title=\"路由回馈\"></a>路由回馈</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730252795715-71f9fcc0-544c-41e7-94a1-cdde5265b108.png\"></p>\n<ul>\n<li></li>\n</ul>\n<ul>\n<li>度量值–种子度量值</li>\n<li>路由器通告与其接口直接相连的链路时，使用的初始度量值叫做种子度量值(也叫做默认度量值)，是根据接口的特征得到的。</li>\n<li>种子度量值或默认度量值是在重分发配置期间定义的，并在自治系统内部正常递增，除了OSPF E2路由。</li>\n<li>可使用命令default-metric或是redistribute中使用metric来指定种子度量值</li>\n</ul>\n<h3 id=\"度量值——默认种子度量值\"><a href=\"#度量值——默认种子度量值\" class=\"headerlink\" title=\"度量值——默认种子度量值\"></a>度量值——默认种子度量值</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730253536563-710553ac-ca47-4ce5-9027-a64118280c8e.png\"></p>\n<h3 id=\"单点重分发\"><a href=\"#单点重分发\" class=\"headerlink\" title=\"单点重分发\"></a>单点重分发</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730256948062-64555df9-3f06-41ec-b0c2-9c14cd5cc025.png\"></p>\n<p>单向重分发</p>\n<p>双向重分发</p>\n<h3 id=\"多点单向重发布\"><a href=\"#多点单向重发布\" class=\"headerlink\" title=\"多点单向重发布\"></a>多点单向重发布</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730257151571-18b8b2e8-3c79-40ea-b97c-d622e5dc20b8.png\"></p>\n<h3 id=\"多点双向重发布\"><a href=\"#多点双向重发布\" class=\"headerlink\" title=\"多点双向重发布\"></a>多点双向重发布</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730257180586-f3f245e3-f240-4044-b59e-b2154fde1431.png\"></p>\n<h1 id=\"Passive-interface\"><a href=\"#Passive-interface\" class=\"headerlink\" title=\"Passive-interface\"></a>Passive-interface</h1><ul>\n<li>RIP&#x2F;IGRP——在指定接口不向外发送路由更新，但是接收路由更新</li>\n<li>EIGRP——在指定接口不向外发送Hello消息，而且通过这个接口不与其他路由器建立邻接关系，不发送其它EIGRP的数据流</li>\n<li>OSPF——在指定接口不向外发送Hello消息，而且通过这 个接口不与其他路由器建立邻接关系，不发送和接收路由信息。(有些IOS版本中OSPF在被动接口上发送Helo和DBD分组，但是不发送LSU。)</li>\n</ul>\n<h2 id=\"Tips\"><a href=\"#Tips\" class=\"headerlink\" title=\"Tips\"></a>Tips</h2><ul>\n<li>汇聚交换机上所有的三层接口都Network进相应的Area</li>\n<li>汇聚交换机将向所有VLAN接口发送HELLO报文，尝试建立邻居关系，而底层的用户也会收到其并不需要的HELLO包</li>\n</ul>\n<h2 id=\"Passive-interface与单播更新\"><a href=\"#Passive-interface与单播更新\" class=\"headerlink\" title=\"Passive-interface与单播更新\"></a>Passive-interface与单播更新</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730339033871-1958274b-9355-4326-a286-f9c3e31efd0e.png\"></p>\n<p>配置RIP单播更新</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Router(config)# router rip</span><br><span class=\"line\">Router(config-router)# passive-interface int-type int-num</span><br><span class=\"line\">Router(config-router)# neighbor 192.168.123.3</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"常见路由协议管理距离\"><a href=\"#常见路由协议管理距离\" class=\"headerlink\" title=\"常见路由协议管理距离\"></a>常见路由协议管理距离</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730339568655-3eb7af04-e1a6-498c-85a3-f72f55fcd42a.png\"></p>\n<h1 id=\"Route-map\"><a href=\"#Route-map\" class=\"headerlink\" title=\"Route-map\"></a>Route-map</h1><h2 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h2><ul>\n<li>使用的match命令匹配特定的分组或路由，set修改该分组或路由的相关属性</li>\n<li>Route-map中的语句相当于访问列表中的各行</li>\n<li>Route-map默认为permit，默认序列号为10，序列号不会自动递增，需要指定序列号</li>\n<li>末尾隐含deny any</li>\n<li>单挑match语句包括多个条件时，使用逻辑or运算；多条match语句时，使用逻辑and运算</li>\n</ul>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">match ip address 匹配访问列表或前缀列表</span><br><span class=\"line\">match length 根据分组的第三层长度进行匹配</span><br><span class=\"line\">match interface 匹配下一跳出接口为指定接口之一的路由</span><br><span class=\"line\">match ip next-hop 匹配下一跳地址为特定访问列表中被允许的那些路由</span><br><span class=\"line\">match metric 匹配具有指定度量值的路由</span><br><span class=\"line\">match route-type 匹配指定类型的路由</span><br><span class=\"line\">match community 匹配BGP共同体</span><br><span class=\"line\">match tag 根据路由的标记进行匹配</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"distribute-list\"><a href=\"#distribute-list\" class=\"headerlink\" title=\"distribute-list\"></a>distribute-list</h1><h2 id=\"distribute-list-可根据下列因素过滤更新\"><a href=\"#distribute-list-可根据下列因素过滤更新\" class=\"headerlink\" title=\"distribute-list 可根据下列因素过滤更新\"></a>distribute-list 可根据下列因素过滤更新</h2><ul>\n<li>入站接口</li>\n<li>出站接口</li>\n<li>从另一种路由协议重分发</li>\n</ul>\n<h2 id=\"对于距离矢量路由协议\"><a href=\"#对于距离矢量路由协议\" class=\"headerlink\" title=\"对于距离矢量路由协议\"></a>对于距离矢量路由协议</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730765382208-5939d7f3-0224-48a4-8bd2-4b38e06c0c22.png\"></p>\n<h2 id=\"对于链路状态路由协议\"><a href=\"#对于链路状态路由协议\" class=\"headerlink\" title=\"对于链路状态路由协议\"></a>对于链路状态路由协议</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730765432018-af56c92b-2a62-4a66-8430-79f752fc4a02.png\"></p>\n<h2 id=\"配置-1\"><a href=\"#配置-1\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730768260182-2e14961d-ad68-4651-ae82-e9eebcc05966.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">R2(config)# access-list 1 permit 192.168.1.0</span><br><span class=\"line\">R2(config)# access-list 1 permit 192.168.2.0</span><br><span class=\"line\">R2(config)# router rip</span><br><span class=\"line\">R2(config-router)# distribute-list 1 out fa 1/0</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"prefix-list\"><a href=\"#prefix-list\" class=\"headerlink\" title=\"prefix-list\"></a>prefix-list</h1><h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730768421821-4f542729-31cd-484e-bd5c-0c7a22b12463.png\"></p>\n<ul>\n<li>外部路由172.16.32.0-39.0&#x2F;24，以及汇总路由32.0&#x2F;21被R1引入OSPF现在需在注入过程中，仅将汇总路由32.0&#x2F;21过滤，所有明细放行，使用ACL匹配路由，该如何写?</li>\n</ul>\n<p><code>R1(config)# access-list 1 deny 172.16.32.0\t#如果加上反掩码呢</code></p>\n<p><code>R1(config)# access-ist 1 permit any</code></p>\n<h2 id=\"前缀列表\"><a href=\"#前缀列表\" class=\"headerlink\" title=\"前缀列表\"></a>前缀列表</h2><ul>\n<li>前缀列表的可控性比访问列表高得多，支持增量修改，更为灵活</li>\n<li>判断路由前缀与前缀列表中的前缀是否匹配</li>\n<li>前缀列表包含序列号，从最小的开始匹配，默认序列为5，以5增加</li>\n<li>如果前缀不与前缀列表中的任何条目匹配，将被拒绝</li>\n</ul>\n<h2 id=\"配置-2\"><a href=\"#配置-2\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730771586431-d5907351-8a3b-4875-bb63-9a586ef96637.png\"></p>\n<p><code>router(config)# **ip prefix-list** &#123;list-name [**seq** number] &#123;**deny | permit**&#125; _network/length_ [**ge** _ge-value_] [**le** _le-value_]</code></p>\n<p>输入条件：length &lt; ge-value &lt; le-value &lt;&#x3D; 32</p>\n<h3 id=\"配置示例\"><a href=\"#配置示例\" class=\"headerlink\" title=\"配置示例\"></a>配置示例</h3><ul>\n<li>匹配某条特定路由：192.168.1.0&#x2F;24<ul>\n<li><code>ip prefix-list pxlist 192.168.1.0/24</code></li>\n</ul>\n</li>\n<li>匹配默认路由：<ul>\n<li><code>ip prefix-list pxlist permit 0.0.0.0/0</code></li>\n</ul>\n</li>\n<li>匹配所有主机路由：<ul>\n<li><code>ip prefix-list pxlist permit 0.0.0.0/0 ge 32</code></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"路径控制\"><a href=\"#路径控制\" class=\"headerlink\" title=\"路径控制\"></a>路径控制</h1><p>网络实现冗余，还需要考虑以下问题</p>\n<ul>\n<li>弹性：实现链路的主动切换同时备用链路可用于负载均衡</li>\n<li>可用性：从主链路切换到备用链路的时间</li>\n<li>自适应：主链路拥塞时也可以使用冗余路径</li>\n<li>性能：提高带宽的使用率</li>\n</ul>\n<h2 id=\"路径控制工具\"><a href=\"#路径控制工具\" class=\"headerlink\" title=\"路径控制工具\"></a>路径控制工具</h2><ul>\n<li>妥善的编制方案：VLSM和CIDR</li>\n<li>重分发和路由协议的特征</li>\n<li>passive-interface</li>\n<li>distribute-list</li>\n<li>prefix-list</li>\n<li>AD的把控</li>\n<li>route-map</li>\n<li>路由标记</li>\n<li>offset-list</li>\n<li>路由标记</li>\n<li>思科IOS IP SLAs</li>\n<li>PBR</li>\n</ul>\n<h2 id=\"offset-list的作用\"><a href=\"#offset-list的作用\" class=\"headerlink\" title=\"offset-list的作用\"></a>offset-list的作用</h2><ul>\n<li>用于在入站或出站时增大通过EIGRP或RIP获悉的路由度量值</li>\n</ul>\n<p><code>router(config-router)# offset-list &#123;access-list-number| name&#125; &#123;in|out&#125; offset [interface-type interface-number]</code></p>\n<h2 id=\"offset-list的配置\"><a href=\"#offset-list的配置\" class=\"headerlink\" title=\"offset-list的配置\"></a>offset-list的配置</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730773350466-5d587359-93a3-41f8-ae95-2a94868aecb4.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">access-list 1 permit 10.1.1.0</span><br><span class=\"line\">router rip</span><br><span class=\"line\">offset-list 1 out 2 serial 0/0</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"PBR策略路由\"><a href=\"#PBR策略路由\" class=\"headerlink\" title=\"PBR策略路由\"></a>PBR策略路由</h1><h2 id=\"PBR\"><a href=\"#PBR\" class=\"headerlink\" title=\"PBR\"></a>PBR</h2><ul>\n<li>基于策略的路由比传统路由能力更强，使用更灵活，它使网络管理者不仅能够根据目的地址而且能够根据协议类型、报文大小、应用或IP源地址来选择转发路径。策略可以定义为通过多路由器的负载平衡或根据总流量在各线上进行报文转发的服务质量来定义策略路由。</li>\n<li>策略路由主要对经过路由器的数据流进行分流和过滤以及感兴趣数据流匹配</li>\n</ul>\n<h2 id=\"传统路由VS策略路由\"><a href=\"#传统路由VS策略路由\" class=\"headerlink\" title=\"传统路由VS策略路由\"></a>传统路由VS策略路由</h2><h3 id=\"传统路由\"><a href=\"#传统路由\" class=\"headerlink\" title=\"传统路由\"></a>传统路由</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775469785-37c97bda-3880-410d-bb4d-3def31028fb9.png\"></p>\n<h3 id=\"策略路由\"><a href=\"#策略路由\" class=\"headerlink\" title=\"策略路由\"></a>策略路由</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775507016-b35087ed-da05-4558-aed6-aafa6e38c85e.png\"></p>\n<h2 id=\"PBR对数据的处理\"><a href=\"#PBR对数据的处理\" class=\"headerlink\" title=\"PBR对数据的处理\"></a>PBR对数据的处理</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730775547268-b569e647-03d1-41eb-b6f6-444d7cd1ac02.png\"></p>\n<h2 id=\"配置-3\"><a href=\"#配置-3\" class=\"headerlink\" title=\"配置\"></a>配置</h2><ul>\n<li>设定分组的下一跳IP（必须为直连IP）<ul>\n<li><code>set ip next-hop ip-address [...ip-address]</code></li>\n</ul>\n</li>\n<li>设定分组的出接口<ul>\n<li><code>set interface type number [...type number]</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"场景1\"><a href=\"#场景1\" class=\"headerlink\" title=\"场景1\"></a>场景1</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1730788273052-453973f9-cb0f-4d85-a1a5-2ed89d2b898b.png\"></p>\n<ul>\n<li>当网络正常时，PC访问外网数据走ISP1</li>\n<li>当ISP1宕机时(GW感知到)，数据切换至ISP2</li>\n<li>当ISP1容机时(GW无感知)，数据仍然走ISP1</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">access-list 1 permit any</span><br><span class=\"line\">route-map PBR permit 10</span><br><span class=\"line\">match ip address 1</span><br><span class=\"line\">set ip next-hop 10.1.1.2 10.2.2.2</span><br></pre></td></tr></table></figure>","categories":[{"name":"思科","path":"api/categories/思科.json"}],"tags":[{"name":"网络","path":"api/tags/网络.json"},{"name":"CCNP","path":"api/tags/CCNP.json"}]}