{"title":"DHCP协议详解和配置","slug":"CCNP/CCNP交换 DHCP协议详解及配置","date":"2024-11-21T01:01:46.000Z","updated":"2025-09-21T10:35:24.786Z","comments":true,"path":"api/articles/CCNP/CCNP交换 DHCP协议详解及配置.json","excerpt":null,"covers":["https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165474365-eb0dcff1-1d39-4423-8a7f-d50f6cccc494.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729166164894-3746dc53-16a4-4763-89f7-d07c779b2eae.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498106851-c554df3c-3861-47ee-b981-06b274a46d00.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498165849-924f9898-3555-4794-99e5-54ee26ea93f9.png","https://cdn.nlark.com/yuque/0/2024/jpeg/44908083/1729498256138-90c814b3-f678-4c44-8db8-3b81f95deabb.jpeg","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498637688-ede34ac4-38ae-472e-98e0-44d3c9108741.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498803330-8cc66a37-1efb-4664-8343-02bccde28ebf.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498968783-22fd05b0-fe27-4135-ae7d-8748bb83d552.png","https://cdn.nlark.com/yuque/0/2024/png/44908083/1729499528933-45786e82-4126-41d6-9cf8-54dc67e32103.png"],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><meta name=\"referrer\" content=\"no-referrer\">\n\n<h2 id=\"DHCP实施背景\"><a href=\"#DHCP实施背景\" class=\"headerlink\" title=\"DHCP实施背景\"></a>DHCP实施背景</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165474365-eb0dcff1-1d39-4423-8a7f-d50f6cccc494.png\"></p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><ul>\n<li>Dynamic Host Configuration Protocol</li>\n<li>基于UDP协议 端口67及68</li>\n<li>bootPC:67（客户端端口号）；bootPS：68（服务端端口号）</li>\n</ul>\n<h2 id=\"传输方式\"><a href=\"#传输方式\" class=\"headerlink\" title=\"传输方式\"></a>传输方式</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729166164894-3746dc53-16a4-4763-89f7-d07c779b2eae.png\"></p>\n<h2 id=\"DHCP中继问题\"><a href=\"#DHCP中继问题\" class=\"headerlink\" title=\"DHCP中继问题\"></a>DHCP中继问题</h2><h3 id=\"案例一\"><a href=\"#案例一\" class=\"headerlink\" title=\"案例一\"></a>案例一</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498106851-c554df3c-3861-47ee-b981-06b274a46d00.png\"></p>\n<ul>\n<li>PC客户端与DHCP server不在同一个网段PC发出的广播DHCP discover包到达三层设备被三层接口丢弃，因此数据无法到达DHCP服务器</li>\n</ul>\n<h3 id=\"案例二\"><a href=\"#案例二\" class=\"headerlink\" title=\"案例二\"></a>案例二</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498165849-924f9898-3555-4794-99e5-54ee26ea93f9.png\"></p>\n<ul>\n<li>在三层交换机(或路由器)上部署DHCP中继，使得DHCPserver能够收到Discover消息</li>\n</ul>\n<h3 id=\"案例三\"><a href=\"#案例三\" class=\"headerlink\" title=\"案例三\"></a>案例三</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/jpeg/44908083/1729498256138-90c814b3-f678-4c44-8db8-3b81f95deabb.jpeg\"></p>\n<p><code>cisco(config-if)# ip helper-address _address_</code></p>\n<ul>\n<li>激活中继功能，并为UDP广播包设置中继目标IP(单播包的目标IP地址)</li>\n<li>注意是在接口上配置，该接口为沿途阻挡该广播消息的第一个接口</li>\n</ul>\n<p><code>cisco(config)# ip forward-protocol &#123; udp [ port ]&#125;</code></p>\n<ul>\n<li>选择被中继的协议(可选)</li>\n</ul>\n<h3 id=\"注意事项1\"><a href=\"#注意事项1\" class=\"headerlink\" title=\"注意事项1\"></a>注意事项1</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498637688-ede34ac4-38ae-472e-98e0-44d3c9108741.png\"></p>\n<p><code>cisco(config)# interface vlan 10</code></p>\n<p><code>cisco(config-if)# ip helper-address 192 168.200.200</code></p>\n<h3 id=\"注意事项2\"><a href=\"#注意事项2\" class=\"headerlink\" title=\"注意事项2\"></a>注意事项2</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498803330-8cc66a37-1efb-4664-8343-02bccde28ebf.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface fast0/0</span><br><span class=\"line\">ip helper-address 10.1.1.200</span><br><span class=\"line\">ip helper-address 10.1.2.200</span><br><span class=\"line\">ip helper-address 10.1.2.201</span><br><span class=\"line\">!!每个地址都会发送一个单播</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Relay-Agent-Option-Support\"><a href=\"#Relay-Agent-Option-Support\" class=\"headerlink\" title=\"Relay Agent Option Support\"></a>Relay Agent Option Support</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498968783-22fd05b0-fe27-4135-ae7d-8748bb83d552.png\"></p>\n<ul>\n<li>发送广播</li>\n<li>Option82插入remoteID及circuitID</li>\n<li>如果识别option82，则查看插入的option值</li>\n<li>除去option字段，实施策略，将IP分配给client</li>\n<li>基于option值，返回IP address及策略</li>\n</ul>\n<h2 id=\"DHCP配置\"><a href=\"#DHCP配置\" class=\"headerlink\" title=\"DHCP配置\"></a>DHCP配置</h2><h3 id=\"手工配置\"><a href=\"#手工配置\" class=\"headerlink\" title=\"手工配置\"></a>手工配置</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729499528933-45786e82-4126-41d6-9cf8-54dc67e32103.png\"></p>\n<ul>\n<li>手动绑定是手动映射到DHCP数据库中的主机的MAC地址的IP地址。手动绑定存储在DHCP服务器上的NVRAM中</li>\n<li>绑定只是特殊的地址池。手动绑定数量没有限制，但每个主机池只能配置一个手动绑定的配置池</li>\n</ul>\n<p><code>ip dhcp pool BIND</code></p>\n<p><code>host 192.168.1.111 255.255.255.0</code></p>\n<p><code>client-identifier unique-identifier</code></p>\n<ul>\n<li>DHCP clients require client identifiers. The unique identification ofthe client is specified in dotted hexadecimal notation, for example.01b7.0813.8811.66,where 01 represents the Ethernet media type.（DHCP客户端需要客户端标识符。客户端的唯一标识符用点十六进制表示法指定，例如01b7.0813.8811.66，其中01表示以太网介质类型。）</li>\n<li>也可以在服务器上通过show ip dhcp bingding抓取客户端的client-identifier</li>\n</ul>\n","more":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h2 id=\"DHCP实施背景\"><a href=\"#DHCP实施背景\" class=\"headerlink\" title=\"DHCP实施背景\"></a>DHCP实施背景</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729165474365-eb0dcff1-1d39-4423-8a7f-d50f6cccc494.png\"></p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><ul>\n<li>Dynamic Host Configuration Protocol</li>\n<li>基于UDP协议 端口67及68</li>\n<li>bootPC:67（客户端端口号）；bootPS：68（服务端端口号）</li>\n</ul>\n<h2 id=\"传输方式\"><a href=\"#传输方式\" class=\"headerlink\" title=\"传输方式\"></a>传输方式</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729166164894-3746dc53-16a4-4763-89f7-d07c779b2eae.png\"></p>\n<h2 id=\"DHCP中继问题\"><a href=\"#DHCP中继问题\" class=\"headerlink\" title=\"DHCP中继问题\"></a>DHCP中继问题</h2><h3 id=\"案例一\"><a href=\"#案例一\" class=\"headerlink\" title=\"案例一\"></a>案例一</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498106851-c554df3c-3861-47ee-b981-06b274a46d00.png\"></p>\n<ul>\n<li>PC客户端与DHCP server不在同一个网段PC发出的广播DHCP discover包到达三层设备被三层接口丢弃，因此数据无法到达DHCP服务器</li>\n</ul>\n<h3 id=\"案例二\"><a href=\"#案例二\" class=\"headerlink\" title=\"案例二\"></a>案例二</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498165849-924f9898-3555-4794-99e5-54ee26ea93f9.png\"></p>\n<ul>\n<li>在三层交换机(或路由器)上部署DHCP中继，使得DHCPserver能够收到Discover消息</li>\n</ul>\n<h3 id=\"案例三\"><a href=\"#案例三\" class=\"headerlink\" title=\"案例三\"></a>案例三</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/jpeg/44908083/1729498256138-90c814b3-f678-4c44-8db8-3b81f95deabb.jpeg\"></p>\n<p><code>cisco(config-if)# ip helper-address _address_</code></p>\n<ul>\n<li>激活中继功能，并为UDP广播包设置中继目标IP(单播包的目标IP地址)</li>\n<li>注意是在接口上配置，该接口为沿途阻挡该广播消息的第一个接口</li>\n</ul>\n<p><code>cisco(config)# ip forward-protocol &#123; udp [ port ]&#125;</code></p>\n<ul>\n<li>选择被中继的协议(可选)</li>\n</ul>\n<h3 id=\"注意事项1\"><a href=\"#注意事项1\" class=\"headerlink\" title=\"注意事项1\"></a>注意事项1</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498637688-ede34ac4-38ae-472e-98e0-44d3c9108741.png\"></p>\n<p><code>cisco(config)# interface vlan 10</code></p>\n<p><code>cisco(config-if)# ip helper-address 192 168.200.200</code></p>\n<h3 id=\"注意事项2\"><a href=\"#注意事项2\" class=\"headerlink\" title=\"注意事项2\"></a>注意事项2</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498803330-8cc66a37-1efb-4664-8343-02bccde28ebf.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface fast0/0</span><br><span class=\"line\">ip helper-address 10.1.1.200</span><br><span class=\"line\">ip helper-address 10.1.2.200</span><br><span class=\"line\">ip helper-address 10.1.2.201</span><br><span class=\"line\">!!每个地址都会发送一个单播</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Relay-Agent-Option-Support\"><a href=\"#Relay-Agent-Option-Support\" class=\"headerlink\" title=\"Relay Agent Option Support\"></a>Relay Agent Option Support</h2><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729498968783-22fd05b0-fe27-4135-ae7d-8748bb83d552.png\"></p>\n<ul>\n<li>发送广播</li>\n<li>Option82插入remoteID及circuitID</li>\n<li>如果识别option82，则查看插入的option值</li>\n<li>除去option字段，实施策略，将IP分配给client</li>\n<li>基于option值，返回IP address及策略</li>\n</ul>\n<h2 id=\"DHCP配置\"><a href=\"#DHCP配置\" class=\"headerlink\" title=\"DHCP配置\"></a>DHCP配置</h2><h3 id=\"手工配置\"><a href=\"#手工配置\" class=\"headerlink\" title=\"手工配置\"></a>手工配置</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2024/png/44908083/1729499528933-45786e82-4126-41d6-9cf8-54dc67e32103.png\"></p>\n<ul>\n<li>手动绑定是手动映射到DHCP数据库中的主机的MAC地址的IP地址。手动绑定存储在DHCP服务器上的NVRAM中</li>\n<li>绑定只是特殊的地址池。手动绑定数量没有限制，但每个主机池只能配置一个手动绑定的配置池</li>\n</ul>\n<p><code>ip dhcp pool BIND</code></p>\n<p><code>host 192.168.1.111 255.255.255.0</code></p>\n<p><code>client-identifier unique-identifier</code></p>\n<ul>\n<li>DHCP clients require client identifiers. The unique identification ofthe client is specified in dotted hexadecimal notation, for example.01b7.0813.8811.66,where 01 represents the Ethernet media type.（DHCP客户端需要客户端标识符。客户端的唯一标识符用点十六进制表示法指定，例如01b7.0813.8811.66，其中01表示以太网介质类型。）</li>\n<li>也可以在服务器上通过show ip dhcp bingding抓取客户端的client-identifier</li>\n</ul>\n","categories":[{"name":"思科","path":"api/categories/思科.json"}],"tags":[{"name":"网络","path":"api/tags/网络.json"},{"name":"CCNP","path":"api/tags/CCNP.json"}]}