{"title":"Lay2 Switching and VLAN","slug":"CCNP/CCNP交换 Lay2 Switching and VLAN","date":"2024-10-17T07:01:46.000Z","updated":"2025-08-02T10:17:53.224Z","comments":true,"path":"api/articles/CCNP/CCNP交换 Lay2 Switching and VLAN.json","excerpt":null,"covers":["https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(10).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(9).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(8).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(7).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(6).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(5).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(4).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(3).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(2).png","https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(1).png"],"content":"<h2 id=\"Lay2-Switching\"><a href=\"#Lay2-Switching\" class=\"headerlink\" title=\"Lay2 Switching\"></a>Lay2 Switching</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><ul>\n<li>基于硬件的交换</li>\n<li>线速转发性能</li>\n<li>低延迟</li>\n<li>定义MAC地址</li>\n</ul>\n<p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(10).png\"></p>\n<h3 id=\"Lay2-Frame\"><a href=\"#Lay2-Frame\" class=\"headerlink\" title=\"Lay2 Frame\"></a>Lay2 Frame</h3><ul>\n<li>类型字段取值为0800的帧代表IP协议</li>\n<li>类型字段取值为0806的帧代表ARP协议帧</li>\n<li>类型字段取值为0835的帧代表RARP协议帧</li>\n<li>类型字段取值为8137的帧代表IPX和SPX传输协议帧</li>\n</ul>\n<p>Ethernet II帧</p>\n<p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(9).png\"></p>\n<p>802.3帧</p>\n<p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(8).png\"></p>\n<p>MAC<br><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(7).png\"></p>\n<ul>\n<li>MAC地址有48位，通常被表示为点分十六进制数</li>\n<li>MAC地址全球唯一，由IEEE对这些地址进行管理和分配</li>\n<li>每个地址由两部分组成，分别是供应商代码和序列号。其中前24位二进制代表该供应商代码。剩下的24位由厂商自己分配</li>\n</ul>\n<h2 id=\"VLAN概率回顾\"><a href=\"#VLAN概率回顾\" class=\"headerlink\" title=\"VLAN概率回顾\"></a>VLAN概率回顾</h2><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(6).png\"></p>\n<ul>\n<li>形成逻辑的广播域，不同之间的VLAN互相隔离</li>\n<li>一个VLAN中所有设备都是在同一广播域内，不同的VLAN为不同的广播域VLAN之间互相隔离，广播不能跨越VLAN传播，因此不同VLAN之间的设备一般无法互访，不同VLAN间需通过三层设备实现相互通信</li>\n<li>一个VLAN一般为一个逻辑子网，由被配置为此VLAN成员的设备组成VLAN中成员多基于交换机的端口分配，划分VLAN就是对交换机的接口划分</li>\n<li>VLAN工作于OSI参考模型的第二层</li>\n<li>VLAN是二层交换机的一个非常根本的工作机制</li>\n</ul>\n<h2 id=\"Trunk概念回顾\"><a href=\"#Trunk概念回顾\" class=\"headerlink\" title=\"Trunk概念回顾\"></a>Trunk概念回顾</h2><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(5).png\"></p>\n<ul>\n<li>当一条链路，需要承载多VLAN信息的时候，需使用trunk来实现</li>\n<li>Trunk两端的交换机需擦用相同的干道协议</li>\n<li>一般见于交换机之间或交换机与路由器、服务器之间</li>\n</ul>\n<h2 id=\"ISL与802-1Q\"><a href=\"#ISL与802-1Q\" class=\"headerlink\" title=\"ISL与802.1Q\"></a>ISL与802.1Q</h2><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(4).png\"></p>\n<h3 id=\"ISL\"><a href=\"#ISL\" class=\"headerlink\" title=\"ISL\"></a>ISL</h3><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(3).png\"></p>\n<ul>\n<li>思科私有协议</li>\n<li>支持PVST</li>\n<li>在原始数据帧基础上封装ISL头及新的FCS</li>\n<li>没有修改原始的数据帧，因此处理效率比802.1Q高</li>\n<li>VLAN字段，15分比特目前用了十个，那么最多支持2的10次方&#x3D;1024个VLAN</li>\n</ul>\n<h3 id=\"802-1Q\"><a href=\"#802-1Q\" class=\"headerlink\" title=\"802.1Q\"></a>802.1Q</h3><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(2).png\"></p>\n<ul>\n<li>IEEE共有协议</li>\n<li>插入Tag字段，同时重新计算FCS</li>\n</ul>\n<h2 id=\"Native-VLAN\"><a href=\"#Native-VLAN\" class=\"headerlink\" title=\"Native VLAN\"></a>Native VLAN</h2><ul>\n<li>Native VLAN所属的帧在经过trunk时不打标签</li>\n<li>Native VLAN在Trunk两端必须匹配，否则会出现VLAN流量互串</li>\n<li>默认native vlan是vlan1</li>\n<li>建议将一个生僻的VLAN配置成Native VLAN</li>\n</ul>\n<p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(1).png\"></p>\n<h3 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Router(config-if)# switchport trunk native vlan ? #在trunk设置native vlan</span><br><span class=\"line\">Router(config)# vlan dot1q tag native #也对native vlan打标签</span><br></pre></td></tr></table></figure>","more":"<h2 id=\"Lay2-Switching\"><a href=\"#Lay2-Switching\" class=\"headerlink\" title=\"Lay2 Switching\"></a>Lay2 Switching</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><ul>\n<li>基于硬件的交换</li>\n<li>线速转发性能</li>\n<li>低延迟</li>\n<li>定义MAC地址</li>\n</ul>\n<p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(10).png\"></p>\n<h3 id=\"Lay2-Frame\"><a href=\"#Lay2-Frame\" class=\"headerlink\" title=\"Lay2 Frame\"></a>Lay2 Frame</h3><ul>\n<li>类型字段取值为0800的帧代表IP协议</li>\n<li>类型字段取值为0806的帧代表ARP协议帧</li>\n<li>类型字段取值为0835的帧代表RARP协议帧</li>\n<li>类型字段取值为8137的帧代表IPX和SPX传输协议帧</li>\n</ul>\n<p>Ethernet II帧</p>\n<p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(9).png\"></p>\n<p>802.3帧</p>\n<p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(8).png\"></p>\n<p>MAC<br><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(7).png\"></p>\n<ul>\n<li>MAC地址有48位，通常被表示为点分十六进制数</li>\n<li>MAC地址全球唯一，由IEEE对这些地址进行管理和分配</li>\n<li>每个地址由两部分组成，分别是供应商代码和序列号。其中前24位二进制代表该供应商代码。剩下的24位由厂商自己分配</li>\n</ul>\n<h2 id=\"VLAN概率回顾\"><a href=\"#VLAN概率回顾\" class=\"headerlink\" title=\"VLAN概率回顾\"></a>VLAN概率回顾</h2><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(6).png\"></p>\n<ul>\n<li>形成逻辑的广播域，不同之间的VLAN互相隔离</li>\n<li>一个VLAN中所有设备都是在同一广播域内，不同的VLAN为不同的广播域VLAN之间互相隔离，广播不能跨越VLAN传播，因此不同VLAN之间的设备一般无法互访，不同VLAN间需通过三层设备实现相互通信</li>\n<li>一个VLAN一般为一个逻辑子网，由被配置为此VLAN成员的设备组成VLAN中成员多基于交换机的端口分配，划分VLAN就是对交换机的接口划分</li>\n<li>VLAN工作于OSI参考模型的第二层</li>\n<li>VLAN是二层交换机的一个非常根本的工作机制</li>\n</ul>\n<h2 id=\"Trunk概念回顾\"><a href=\"#Trunk概念回顾\" class=\"headerlink\" title=\"Trunk概念回顾\"></a>Trunk概念回顾</h2><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(5).png\"></p>\n<ul>\n<li>当一条链路，需要承载多VLAN信息的时候，需使用trunk来实现</li>\n<li>Trunk两端的交换机需擦用相同的干道协议</li>\n<li>一般见于交换机之间或交换机与路由器、服务器之间</li>\n</ul>\n<h2 id=\"ISL与802-1Q\"><a href=\"#ISL与802-1Q\" class=\"headerlink\" title=\"ISL与802.1Q\"></a>ISL与802.1Q</h2><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(4).png\"></p>\n<h3 id=\"ISL\"><a href=\"#ISL\" class=\"headerlink\" title=\"ISL\"></a>ISL</h3><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(3).png\"></p>\n<ul>\n<li>思科私有协议</li>\n<li>支持PVST</li>\n<li>在原始数据帧基础上封装ISL头及新的FCS</li>\n<li>没有修改原始的数据帧，因此处理效率比802.1Q高</li>\n<li>VLAN字段，15分比特目前用了十个，那么最多支持2的10次方&#x3D;1024个VLAN</li>\n</ul>\n<h3 id=\"802-1Q\"><a href=\"#802-1Q\" class=\"headerlink\" title=\"802.1Q\"></a>802.1Q</h3><p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(2).png\"></p>\n<ul>\n<li>IEEE共有协议</li>\n<li>插入Tag字段，同时重新计算FCS</li>\n</ul>\n<h2 id=\"Native-VLAN\"><a href=\"#Native-VLAN\" class=\"headerlink\" title=\"Native VLAN\"></a>Native VLAN</h2><ul>\n<li>Native VLAN所属的帧在经过trunk时不打标签</li>\n<li>Native VLAN在Trunk两端必须匹配，否则会出现VLAN流量互串</li>\n<li>默认native vlan是vlan1</li>\n<li>建议将一个生僻的VLAN配置成Native VLAN</li>\n</ul>\n<p><img src=\"https://cdn.sumi233.top/gh/huang233893/blog-image-bed/top/huang233893/imgs/blog/Lay2sw%26vlan%20(1).png\"></p>\n<h3 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Router(config-if)# switchport trunk native vlan ? #在trunk设置native vlan</span><br><span class=\"line\">Router(config)# vlan dot1q tag native #也对native vlan打标签</span><br></pre></td></tr></table></figure>","categories":[{"name":"思科","path":"api/categories/思科.json"}],"tags":[{"name":"网络","path":"api/tags/网络.json"},{"name":"CCNP","path":"api/tags/CCNP.json"}]}